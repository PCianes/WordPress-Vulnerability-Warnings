const request = require("request-promise");
const cheerio = require("cheerio");

async function requestDataFromUrl(url) {
  return await request({
    uri: url,
    transform: (body) => cheerio.load(body),
  });
}

async function getTableData(url) {
  let data = [];
  try {
    const $ = await requestDataFromUrl(url);
    $("table > tbody > tr").each((i, el) => {
      const td = $(el).find("td");
      data.push({
        name: $(td[0]).text(),
        published: $(td[1]).text(),
        title: $(td[2]).text(),
      });
    });
    return data;
  } catch (error) {
    console.log(error);
  }
}

async function init() {
  const baseURL = "https://wpvulndb.com/";
  const plugins = await getTableData(baseURL + "/plugins");
  const themes = await getTableData(baseURL + "/themes");

  Promise.all([plugins, themes])
    .then((data) => console.log(data))
    .catch((err) => console.log(err));
}

init();
