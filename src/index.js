const request = require("request-promise");
const cheerio = require("cheerio");

async function requestDataFromUrl(url) {
  return await request({
    uri: url,
    transform: (body) => cheerio.load(body),
  });
}

async function getPluginsData(url) {
  let plugins = [];
  try {
    const $ = await requestDataFromUrl(url);
    $("table > tbody > tr").each((i, el) => {
      plugins.push({
        name: $($(el).find("td")[0]).text(),
        published: $($(el).find("td")[1]).text(),
        title: $($(el).find("td")[2]).text(),
      });
    });
    return plugins;
  } catch (error) {
    console.log(error);
  }
}

getPluginsData("https://wpvulndb.com/plugins").then((data) =>
  console.log(data)
);
